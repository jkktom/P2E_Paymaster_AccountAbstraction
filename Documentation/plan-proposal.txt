Refined 3-Entity Proposal System Design                                                                                                                 ‚îÇ
     ‚îÇ                                                                                                                                                         ‚îÇ
     ‚îÇ üéØ Your Approach Analysis                                                                                                                               ‚îÇ
     ‚îÇ                                                                                                                                                         ‚îÇ
     ‚îÇ Excellent design! This follows proper database normalization and separation of concerns:                                                                ‚îÇ
     ‚îÇ                                                                                                                                                         ‚îÇ
     ‚îÇ 1. Proposal Entity: Mirror smart contract exactly - no extra data                                                                                       ‚îÇ
     ‚îÇ 2. ProposalVoteCount Entity: Real-time vote aggregation - separate from blockchain data                                                                 ‚îÇ
     ‚îÇ 3. UserVote Entity: Individual vote records with Google ID indexing                                                                                     ‚îÇ
     ‚îÇ                                                                                                                                                         ‚îÇ
     ‚îÇ üìä 3-Entity Architecture                                                                                                                                ‚îÇ
     ‚îÇ                                                                                                                                                         ‚îÇ
     ‚îÇ Entity 1: Proposal (Smart Contract Mirror)                                                                                                              ‚îÇ
     ‚îÇ                                                                                                                                                         ‚îÇ
     ‚îÇ @Entity                                                                                                                                                 ‚îÇ
     ‚îÇ @Table(name = "proposals")                                                                                                                              ‚îÇ
     ‚îÇ public class Proposal {                                                                                                                                 ‚îÇ
     ‚îÇ     @Id                                                                                                                                                 ‚îÇ
     ‚îÇ     @GeneratedValue(strategy = GenerationType.IDENTITY)                                                                                                 ‚îÇ
     ‚îÇ     private Long id;                                                                                                                                    ‚îÇ
     ‚îÇ                                                                                                                                                         ‚îÇ
     ‚îÇ     @Column(name = "blockchain_proposal_id", unique = true, nullable = false)                                                                           ‚îÇ
     ‚îÇ     private Integer blockchainProposalId;  // Smart contract proposal ID                                                                                ‚îÇ
     ‚îÇ                                                                                                                                                         ‚îÇ
     ‚îÇ     @Column(name = "description", columnDefinition = "TEXT", nullable = false)                                                                          ‚îÇ
     ‚îÇ     private String description;                                                                                                                         ‚îÇ
     ‚îÇ                                                                                                                                                         ‚îÇ
     ‚îÇ     @Column(name = "proposer_address", length = 42, nullable = false)                                                                                   ‚îÇ
     ‚îÇ     private String proposerAddress;  // Wallet address from smart contract                                                                              ‚îÇ
     ‚îÇ                                                                                                                                                         ‚îÇ
     ‚îÇ     @Column(name = "deadline", nullable = false)                                                                                                        ‚îÇ
     ‚îÇ     private LocalDateTime deadline;                                                                                                                     ‚îÇ
     ‚îÇ                                                                                                                                                         ‚îÇ
     ‚îÇ     @Column(name = "executed", nullable = false)                                                                                                        ‚îÇ
     ‚îÇ     private Boolean executed = false;                                                                                                                   ‚îÇ
     ‚îÇ                                                                                                                                                         ‚îÇ
     ‚îÇ     @Column(name = "canceled", nullable = false)                                                                                                        ‚îÇ
     ‚îÇ     private Boolean canceled = false;                                                                                                                   ‚îÇ
     ‚îÇ                                                                                                                                                         ‚îÇ
     ‚îÇ     @Column(name = "created_at", nullable = false)                                                                                                      ‚îÇ
     ‚îÇ     private LocalDateTime createdAt;                                                                                                                    ‚îÇ
     ‚îÇ                                                                                                                                                         ‚îÇ
     ‚îÇ     // Additional backend fields                                                                                                                        ‚îÇ
     ‚îÇ     @Column(name = "tx_hash", length = 66)                                                                                                              ‚îÇ
     ‚îÇ     private String txHash;  // Creation transaction hash                                                                                                ‚îÇ
     ‚îÇ                                                                                                                                                         ‚îÇ
     ‚îÇ     @Column(name = "proposer_google_id", length = 50)                                                                                                   ‚îÇ
     ‚îÇ     private String proposerGoogleId;  // Link to our user system                                                                                        ‚îÇ
     ‚îÇ }                                                                                                                                                       ‚îÇ
     ‚îÇ                                                                                                                                                         ‚îÇ
     ‚îÇ Entity 2: ProposalVoteCount (Real-time Aggregation)                                                                                                     ‚îÇ
     ‚îÇ                                                                                                                                                         ‚îÇ
     ‚îÇ @Entity                                                                                                                                                 ‚îÇ
     ‚îÇ @Table(name = "proposal_vote_counts")                                                                                                                   ‚îÇ
     ‚îÇ public class ProposalVoteCount {                                                                                                                        ‚îÇ
     ‚îÇ     @Id                                                                                                                                                 ‚îÇ
     ‚îÇ     private Long proposalId;  // Same as Proposal.id                                                                                                    ‚îÇ
     ‚îÇ                                                                                                                                                         ‚îÇ
     ‚îÇ     @OneToOne                                                                                                                                           ‚îÇ
     ‚îÇ     @MapsId                                                                                                                                             ‚îÇ
     ‚îÇ     @JoinColumn(name = "proposal_id")                                                                                                                   ‚îÇ
     ‚îÇ     private Proposal proposal;                                                                                                                          ‚îÇ
     ‚îÇ                                                                                                                                                         ‚îÇ
     ‚îÇ     @Column(name = "for_votes", precision = 20, scale = 0, nullable = false)                                                                            ‚îÇ
     ‚îÇ     private BigInteger forVotes = BigInteger.ZERO;  // Wei format                                                                                       ‚îÇ
     ‚îÇ                                                                                                                                                         ‚îÇ
     ‚îÇ     @Column(name = "against_votes", precision = 20, scale = 0, nullable = false)                                                                        ‚îÇ
     ‚îÇ     private BigInteger againstVotes = BigInteger.ZERO;  // Wei format                                                                                   ‚îÇ
     ‚îÇ                                                                                                                                                         ‚îÇ
     ‚îÇ     @Column(name = "total_voters", nullable = false)                                                                                                    ‚îÇ
     ‚îÇ     private Integer totalVoters = 0;                                                                                                                    ‚îÇ
     ‚îÇ                                                                                                                                                         ‚îÇ
     ‚îÇ     @Column(name = "last_updated", nullable = false)                                                                                                    ‚îÇ
     ‚îÇ     private LocalDateTime lastUpdated;                                                                                                                  ‚îÇ
     ‚îÇ                                                                                                                                                         ‚îÇ
     ‚îÇ     // Computed fields for convenience                                                                                                                  ‚îÇ
     ‚îÇ     public BigInteger getTotalVotes() {                                                                                                                 ‚îÇ
     ‚îÇ         return forVotes.add(againstVotes);                                                                                                              ‚îÇ
     ‚îÇ     }                                                                                                                                                   ‚îÇ
     ‚îÇ                                                                                                                                                         ‚îÇ
     ‚îÇ     public double getForPercentage() {                                                                                                                  ‚îÇ
     ‚îÇ         BigInteger total = getTotalVotes();                                                                                                             ‚îÇ
     ‚îÇ         if (total.equals(BigInteger.ZERO)) return 0.0;                                                                                                  ‚îÇ
     ‚îÇ         return forVotes.multiply(BigInteger.valueOf(100)).divide(total).doubleValue();                                                                  ‚îÇ
     ‚îÇ     }                                                                                                                                                   ‚îÇ
     ‚îÇ }                                                                                                                                                       ‚îÇ
     ‚îÇ                                                                                                                                                         ‚îÇ
     ‚îÇ Entity 3: UserVote (Individual Vote Records)                                                                                                            ‚îÇ
     ‚îÇ                                                                                                                                                         ‚îÇ
     ‚îÇ @Entity                                                                                                                                                 ‚îÇ
     ‚îÇ @Table(name = "user_votes",                                                                                                                             ‚îÇ
     ‚îÇ        uniqueConstraints = @UniqueConstraint(columnNames = {"proposal_id", "user_google_id"}))                                                          ‚îÇ
     ‚îÇ public class UserVote {                                                                                                                                 ‚îÇ
     ‚îÇ     @Id                                                                                                                                                 ‚îÇ
     ‚îÇ     @GeneratedValue(strategy = GenerationType.IDENTITY)                                                                                                 ‚îÇ
     ‚îÇ     private Long id;                                                                                                                                    ‚îÇ
     ‚îÇ                                                                                                                                                         ‚îÇ
     ‚îÇ     @Column(name = "proposal_id", nullable = false)                                                                                                     ‚îÇ
     ‚îÇ     private Long proposalId;                                                                                                                            ‚îÇ
     ‚îÇ                                                                                                                                                         ‚îÇ
     ‚îÇ     @ManyToOne(fetch = FetchType.LAZY)                                                                                                                  ‚îÇ
     ‚îÇ     @JoinColumn(name = "proposal_id", insertable = false, updatable = false)                                                                            ‚îÇ
     ‚îÇ     private Proposal proposal;                                                                                                                          ‚îÇ
     ‚îÇ                                                                                                                                                         ‚îÇ
     ‚îÇ     @Column(name = "user_google_id", length = 50, nullable = false)                                                                                     ‚îÇ
     ‚îÇ     private String userGoogleId;  // Your user indexing system                                                                                          ‚îÇ
     ‚îÇ                                                                                                                                                         ‚îÇ
     ‚îÇ     @Column(name = "voter_wallet_address", length = 42, nullable = false)                                                                               ‚îÇ
     ‚îÇ     private String voterWalletAddress;  // For blockchain verification                                                                                  ‚îÇ
     ‚îÇ                                                                                                                                                         ‚îÇ
     ‚îÇ     @Column(name = "support", nullable = false)                                                                                                         ‚îÇ
     ‚îÇ     private Boolean support;  // true = FOR, false = AGAINST                                                                                            ‚îÇ
     ‚îÇ                                                                                                                                                         ‚îÇ
     ‚îÇ     @Column(name = "voting_power", precision = 20, scale = 0, nullable = false)                                                                         ‚îÇ
     ‚îÇ     private BigInteger votingPower;  // Wei format - power at time of vote                                                                              ‚îÇ
     ‚îÇ                                                                                                                                                         ‚îÇ
     ‚îÇ     @Column(name = "voted_at", nullable = false)                                                                                                        ‚îÇ
     ‚îÇ     private LocalDateTime votedAt;                                                                                                                      ‚îÇ
     ‚îÇ                                                                                                                                                         ‚îÇ
     ‚îÇ     @Column(name = "tx_hash", length = 66)                                                                                                              ‚îÇ
     ‚îÇ     private String txHash;  // Blockchain transaction hash                                                                                              ‚îÇ
     ‚îÇ                                                                                                                                                         ‚îÇ
     ‚îÇ     @CreationTimestamp                                                                                                                                  ‚îÇ
     ‚îÇ     @Column(name = "recorded_at", nullable = false)                                                                                                     ‚îÇ
     ‚îÇ     private LocalDateTime recordedAt;  // When recorded in our DB                                                                                       ‚îÇ
     ‚îÇ }                                                                                                                                                       ‚îÇ
     ‚îÇ                                                                                                                                                         ‚îÇ
     ‚îÇ üîÑ Data Flow & Benefits                                                                                                                                 ‚îÇ
     ‚îÇ                                                                                                                                                         ‚îÇ
     ‚îÇ Proposal Creation Flow                                                                                                                                  ‚îÇ
     ‚îÇ                                                                                                                                                         ‚îÇ
     ‚îÇ 1. User creates proposal ‚Üí Smart contract call                                                                                                          ‚îÇ
     ‚îÇ 2. Proposal entity: Store exact smart contract data                                                                                                     ‚îÇ
     ‚îÇ 3. ProposalVoteCount entity: Initialize with zero votes                                                                                                 ‚îÇ
     ‚îÇ 4. Frontend gets clean separation of concerns                                                                                                           ‚îÇ
     ‚îÇ                                                                                                                                                         ‚îÇ
     ‚îÇ Voting Flow                                                                                                                                             ‚îÇ
     ‚îÇ                                                                                                                                                         ‚îÇ
     ‚îÇ 1. User votes ‚Üí Smart contract call                                                                                                                     ‚îÇ
     ‚îÇ 2. UserVote entity: Record individual vote with Google ID                                                                                               ‚îÇ
     ‚îÇ 3. ProposalVoteCount entity: Update aggregated totals                                                                                                   ‚îÇ
     ‚îÇ 4. No need to recalculate from individual votes each time                                                                                               ‚îÇ
     ‚îÇ                                                                                                                                                         ‚îÇ
     ‚îÇ Query Benefits                                                                                                                                          ‚îÇ
     ‚îÇ                                                                                                                                                         ‚îÇ
     ‚îÇ -- Get proposal with current vote counts (O(1) lookup)                                                                                                  ‚îÇ
     ‚îÇ SELECT p.*, pvc.for_votes, pvc.against_votes, pvc.total_voters                                                                                          ‚îÇ
     ‚îÇ FROM proposals p                                                                                                                                        ‚îÇ
     ‚îÇ JOIN proposal_vote_counts pvc ON p.id = pvc.proposal_id                                                                                                 ‚îÇ
     ‚îÇ WHERE p.id = ?                                                                                                                                          ‚îÇ
     ‚îÇ                                                                                                                                                         ‚îÇ
     ‚îÇ -- Check if user voted (indexed lookup)                                                                                                                 ‚îÇ
     ‚îÇ SELECT support FROM user_votes                                                                                                                          ‚îÇ
     ‚îÇ WHERE proposal_id = ? AND user_google_id = ?                                                                                                            ‚îÇ
     ‚îÇ                                                                                                                                                         ‚îÇ
     ‚îÇ -- User's voting history                                                                                                                                ‚îÇ
     ‚îÇ SELECT uv.*, p.description                                                                                                                              ‚îÇ
     ‚îÇ FROM user_votes uv                                                                                                                                      ‚îÇ
     ‚îÇ JOIN proposals p ON uv.proposal_id = p.id                                                                                                               ‚îÇ
     ‚îÇ WHERE uv.user_google_id = ?                                                                                                                             ‚îÇ
     ‚îÇ                                                                                                                                                         ‚îÇ
     ‚îÇ üèó Implementation Strategy                                                                                                                              ‚îÇ
     ‚îÇ                                                                                                                                                         ‚îÇ
     ‚îÇ Services                                                                                                                                                ‚îÇ
     ‚îÇ                                                                                                                                                         ‚îÇ
     ‚îÇ - ProposalService: CRUD for proposals + smart contract integration                                                                                      ‚îÇ
     ‚îÇ - VotingService: Handle voting logic + update both UserVote & ProposalVoteCount                                                                         ‚îÇ
     ‚îÇ - ProposalSyncService: Sync with blockchain events                                                                                                      ‚îÇ
     ‚îÇ                                                                                                                                                         ‚îÇ
     ‚îÇ Key Advantages of Your Design                                                                                                                           ‚îÇ
     ‚îÇ                                                                                                                                                         ‚îÇ
     ‚îÇ 1. Clean Separation: Smart contract data vs. application data                                                                                           ‚îÇ
     ‚îÇ 2. Performance: Aggregated vote counts avoid expensive calculations                                                                                     ‚îÇ
     ‚îÇ 3. Flexibility: Easy to add features without touching core proposal data                                                                                ‚îÇ
     ‚îÇ 4. Consistency: Google ID indexing matches your existing user system                                                                                    ‚îÇ
     ‚îÇ 5. Scalability: Can handle large numbers of votes efficiently                                                                                           ‚îÇ
     ‚îÇ                                                                                                                                                         ‚îÇ
     ‚îÇ Database Indexes                                                                                                                                        ‚îÇ
     ‚îÇ                                                                                                                                                         ‚îÇ
     ‚îÇ -- Proposals                                                                                                                                            ‚îÇ
     ‚îÇ CREATE INDEX idx_proposals_blockchain_id ON proposals(blockchain_proposal_id);                                                                          ‚îÇ
     ‚îÇ CREATE INDEX idx_proposals_status ON proposals(executed, canceled, deadline);                                                                           ‚îÇ
     ‚îÇ CREATE INDEX idx_proposals_proposer ON proposals(proposer_google_id);                                                                                   ‚îÇ
     ‚îÇ                                                                                                                                                         ‚îÇ
     ‚îÇ -- User Votes                                                                                                                                           ‚îÇ
     ‚îÇ CREATE INDEX idx_user_votes_user ON user_votes(user_google_id);                                                                                         ‚îÇ
     ‚îÇ CREATE INDEX idx_user_votes_proposal ON user_votes(proposal_id);                                                                                        ‚îÇ
     ‚îÇ                                                                                                                                                         ‚îÇ
     ‚îÇ -- Vote Counts (primary key is already optimal)                                                                                                         ‚îÇ
     ‚îÇ                                                                                                                                                         ‚îÇ
     ‚îÇ This design perfectly aligns with your existing architecture while maintaining clean separation between blockchain state and application-specific data!